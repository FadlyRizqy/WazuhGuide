<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Instalasi Wazuh - Panduan SIEM</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9fafb;
      color: #111827;
      line-height: 1.7;
    }
    header {
      background: #1e3a8a;
      color: white;
      padding: 2rem 1rem;
      text-align: center;
    }
    main {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem 2rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    h1, h2 {
      color: #1e40af;
    }
    details {
      margin: 1rem 0;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 0.8rem 1rem;
      background: #f9fafb;
    }
    summary {
      cursor: pointer;
      font-weight: 600;
      font-size: 1.1rem;
      color: #111827;
    }
    summary:hover {
      color: #1d4ed8;
    }
    pre {
      background: #f3f4f6;
      padding: 1rem;
      overflow-x: auto;
      border-left: 4px solid #3b82f6;
      border-radius: 4px;
    }
    code {
      font-family: monospace;
    }
  </style>
</head>
<body>
  <header>
    <h1>Panduan Instalasi Wazuh SIEM</h1>
    <p>Langkah-langkah instalasi server dan agent untuk sistem keamanan Wazuh</p>
  </header>

  <main>
    <h2>4.2 Instalasi Wazuh</h2>

    <details open>
      <summary><strong>a. Instalasi Wazuh Server</strong></summary>
      <p><strong>Wazuh Server</strong> adalah komponen utama yang mengelola, menganalisis, dan menyimpan data dari endpoint.</p>

      <ol>
        <li><strong>Instalasi Curl</strong>
          <pre><code>sudo apt install curl -y</code></pre>
        </li>
        <li><strong>Unduh dan Jalankan Skrip Instalasi Wazuh</strong>
          <pre><code>curl -sO https://packages.wazuh.com/4.7/wazuh-install.sh && sudo bash ./wazuh-install.sh -a</code></pre>
        </li>
        <li><strong>Catat Informasi Login</strong>
          <p>Setelah instalasi selesai, catat username dan password dari output <code>INFO: — Summary —</code>.</p>
        </li>
        <li><strong>Akses Wazuh Dashboard</strong>
          <pre><code>https://&lt;wazuh-dashboard-ip&gt;</code></pre>
          <p>Gantilah <code>&lt;wazuh-dashboard-ip&gt;</code> dengan alamat IP server Anda.</p>
        </li>
      </ol>
    </details>

    <details>
      <summary><strong>b. Instalasi Wazuh Agent</strong></summary>
      <p><strong>Wazuh Agent</strong> diinstal pada endpoint seperti server/desktop yang akan dikirim datanya ke server utama.</p>

      <ol>
        <li><strong>Tambahkan Repositori Wazuh</strong>
          <pre><code>curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | gpg --no-default-keyring \
--keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import && chmod 644 /usr/share/keyrings/wazuh.gpg

echo "deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main" | \
tee -a /etc/apt/sources.list.d/wazuh.list

apt-get update</code></pre>
        </li>
        <li><strong>Instalasi Wazuh Agent</strong>
          <pre><code>WAZUH_MANAGER="&lt;SERVER_IP&gt;" apt-get install wazuh-agent</code></pre>
          <p>Gantilah <code>&lt;SERVER_IP&gt;</code> dengan IP Wazuh Server.</p>
        </li>
        <li><strong>Jalankan Wazuh Agent</strong>
          <pre><code>systemctl daemon-reload
systemctl enable wazuh-agent
systemctl start wazuh-agent</code></pre>
        </li>
      </ol>
    </details>

    <h2>4.3 Konfigurasi Wazuh</h2>

<details open>
  <summary><strong>a. File Integrity Monitoring (FIM) pada Wazuh</strong></summary>

  <p><strong>FIM</strong> bertugas memantau perubahan file dan direktori penting untuk mencegah aktivitas mencurigakan atau peretasan. Berikut tahapan konfigurasi lengkapnya:</p>

  <ol>
    <li><strong>Instalasi Apache Web Server & PHP</strong>
      <pre><code>sudo apt update
sudo apt install apache2
sudo apt install --no-install-recommends php</code></pre>
    </li>

    <li><strong>Verifikasi Apache</strong>
      <p>Buka <code>http://&lt;AGENT_IP&gt;</code> dari browser untuk melihat halaman default Apache.</p>
    </li>

    <li><strong>Ubah Konfigurasi Ossec untuk FIM</strong>
      <pre><code>&lt;directories realtime="yes" check_all="yes" report_changes="yes"&gt;/var/www/html&lt;/directories&gt;</code></pre>
      <p>Edit pada file <code>/var/ossec/etc/ossec.conf</code> di bagian <code>&lt;syscheck&gt;</code>.</p>
    </li>

    <li><strong>Instalasi auditd</strong>
      <pre><code>sudo apt update
sudo apt install auditd</code></pre>
    </li>

    <li><strong>Forward log auditd ke Wazuh</strong>
      <pre><code>&lt;ossec_config&gt;
  &lt;localfile&gt;
    &lt;location&gt;/var/log/audit/audit.log&lt;/location&gt;
    &lt;log_format&gt;audit&lt;/log_format&gt;
  &lt;/localfile&gt;
&lt;/ossec_config&gt;</code></pre>
    </li>

    <li><strong>Temukan User ID Apache</strong>
      <pre><code>sudo apachectl -S</code></pre>
    </li>

    <li><strong>Tambahkan Auditd Rules</strong>
      <pre><code># Ganti &lt;USER_ID&gt; sesuai hasil sebelumnya
-a always,exit -F arch=b32 -S execve -F uid=&lt;USER_ID&gt; -F key=webshell_command_exec
-a always,exit -F arch=b64 -S execve -F uid=&lt;USER_ID&gt; -F key=webshell_command_exec

-a always,exit -F arch=b64 -S socket -F a0=10 -F euid=&lt;USER_ID&gt; -k webshell_net_connect
-a always,exit -F arch=b64 -S socket -F a0=2 -F euid=&lt;USER_ID&gt; -k webshell_net_connect
-a always,exit -F arch=b32 -S socket -F a0=10 -F euid=&lt;USER_ID&gt; -k webshell_net_connect
-a always,exit -F arch=b32 -S socket -F a0=2 -F euid=&lt;USER_ID&gt; -k webshell_net_connect</code></pre>
    </li>

    <li><strong>Monitoring Command via Shell</strong>
      <pre><code>&lt;ossec_config&gt;
  &lt;localfile&gt;
    &lt;log_format&gt;full_command&lt;/log_format&gt;
    &lt;command&gt;ss -nputw | egrep '"sh"|"bash"|"csh"|"ksh"|"zsh"' | awk '{{ print $5 "|" $6 }}'&lt;/command&gt;
    &lt;alias&gt;webshell connections&lt;/alias&gt;
    &lt;frequency&gt;120&lt;/frequency&gt;
  &lt;/localfile&gt;
&lt;/ossec_config&gt;</code></pre>
    </li>

    <li><strong>Restart Auditd & Wazuh Agent</strong>
      <pre><code>sudo systemctl restart auditd
sudo systemctl restart wazuh-agent</code></pre>
    </li>

    <li><strong>Tambahkan Custom Rules</strong>
      <p>Buat file <code>webshell_rules.xml</code> di <code>/var/ossec/etc/rules/</code>:</p>
      <pre><code>sudo gedit /var/ossec/etc/rules/webshell_rules.xml</code></pre>
    </li>

    <li><strong>Konfigurasi Rules PHP Webshell</strong>
      <pre><code>&lt;group name="linux, webshell, windows,"&gt;
  &lt;rule id="100500" level="12"&gt;
    &lt;if_sid&gt;554&lt;/if_sid&gt;
    &lt;field name="file" type="pcre2"&gt;(?i).php$|.phtml$|.php3$|.php4$|.php5$|.phps$&lt;/field&gt;
    &lt;description&gt;[File creation]: Possible web shell file created&lt;/description&gt;
  &lt;/rule&gt;

  &lt;rule id="100501" level="12"&gt;
    &lt;if_sid&gt;550&lt;/if_sid&gt;
    &lt;field name="file" type="pcre2"&gt;(?i).php$|.phtml$|.php3$|.php4$&lt;/field&gt;
    &lt;description&gt;[File modification]: Possible web shell content added&lt;/description&gt;
  &lt;/rule&gt;

  &lt;rule id="100502" level="15"&gt;
    &lt;if_sid&gt;100501&lt;/if_sid&gt;
    &lt;field name="changed_content" type="pcre2"&gt;(?i)eval|exec|base64_decode|system&lt;/field&gt;
    &lt;description&gt;[File Modification]: Web shell detected&lt;/description&gt;
  &lt;/rule&gt;
&lt;/group&gt;</code></pre>
    </li>

    <li><strong>Rule Tambahan: Command Execution (Linux & Windows)</strong>
      <p>Masukkan rules tambahan untuk mendeteksi eksekusi shell dan koneksi jaringan.</p>
    </li>

    <li><strong>Tambahkan Decoder</strong>
      <p>Di <code>/var/ossec/etc/decoders/local_decoder.xml</code></p>
      <pre><code>&lt;decoder name="network-traffic-child"&gt;
  &lt;parent&gt;ossec&lt;/parent&gt;
  &lt;prematch&gt;^output: 'webshell connections':&lt;/prematch&gt;
  &lt;regex&gt;(\d+.\d+.\d+.\d+):(\d+)\|(\d+.\d+.\d+.\d+):(\d+)&lt;/regex&gt;
  &lt;order&gt;local_ip, local_port, foreign_ip, foreign_port&lt;/order&gt;
&lt;/decoder&gt;</code></pre>
    </li>

    <li><strong>Rules Koneksi Jaringan dari Script</strong>
      <pre><code>&lt;group name="linux, webshell,"&gt;
  &lt;rule id="100510" level="12"&gt;
    &lt;decoded_as&gt;ossec&lt;/decoded_as&gt;
    &lt;match&gt;ossec: output: 'webshell connections'&lt;/match&gt;
    &lt;description&gt;Script attempting network connection&lt;/description&gt;
  &lt;/rule&gt;
&lt;/group&gt;</code></pre>
    </li>

    <li><strong>Restart Wazuh Manager</strong>
      <pre><code>sudo systemctl restart wazuh-manager</code></pre>
    </li>
  </ol>
</details>
  </main>
</body>
</html>
